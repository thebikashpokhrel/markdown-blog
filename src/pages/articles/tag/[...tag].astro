---
import MainLayout from "../../../layouts/MainLayout.astro";
import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";
import ArticleCard from "../../../components/ArticleCard.astro";
import { ARTICLES_PER_PAGE } from "../../../constants";

const blogArticles: CollectionEntry<"blog">[] = (
  await getCollection("blog")
).sort(
  (a: CollectionEntry<"blog">, b: CollectionEntry<"blog">) =>
    b.data.date.valueOf() - a.data.date.valueOf()
);

const { tag } = Astro.params;

if (tag == undefined) {
  throw new Error("Tag is required");
}

const tagArticles = blogArticles.filter((article) =>
  article.data.tags.includes(tag)
);
---

<MainLayout title="Home">
  <a
    href="/"
    class="inline-block mb-4 bg-slate-700 text-white text-sm px-3 py-1.5 rounded-md transition hover:bg-slate-600 focus:outline-none"
  >
    Back to Home
  </a>
  <h2 class="text-xl font-semibold dark:text-white text-gray-800 mb-6 mt-2">
    Tag <span class="text-sm bg-blue-100 text-blue-800 rounded-full px-2 py-1"
      >{tag}</span
    > -
    {tagArticles.length} Article{tagArticles.length > 1 ? "s" : ""}
  </h2>

  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
    {
      tagArticles
        .slice(0, ARTICLES_PER_PAGE)
        .map((article) => <ArticleCard article={article} />)
    }
  </div>
</MainLayout>
